<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Metainfo Mapper is a privacy-focused drone GPS mapping tool that processes your drone imagery locally in your browser. Extract GPS coordinates, generate KML files, and analyze RTK data without uploading any photos to servers. Supports DJI drones and multiple image formats including JPG, TIFF, PNG, and RAW files.">
    <title>Metainfo Mapper - Client-Side Drone GPS Viewer</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <div id="app">
        <div id="sidebar">
            <h1>Metainfo <span>Mapper</span></h1>
            <p class="tagline">Map your drone imagery without ever sending a photo to the server.</p>

            <div class="theme-toggle">
                <span>Theme</span>
                <button id="theme-toggle" class="secondary-btn">Switch to Light</button>
            </div>

            <div id="session-section">
                <h3>Session Setup</h3>
                <div id="new-session">
                    <input type="text" id="location-name" placeholder="Name your mission (e.g., Sunrise Survey)"> 
                    <button id="start-session">Start New Session</button>
                </div>
                <div id="load-session" style="display:none;">
                    <button id="load-kml-btn">Load Previous KML</button>
                    <input type="file" id="kml-input" accept=".kml,.kmz" style="display:none;">
                </div>
                <hr>
            </div>


            <div id="upload-section" style="display:none;">
                <h3>Add Images <span class="help-icon" data-help-title="Add Images" data-help-content="Drag and drop image files or folders containing JPG, TIFF, PNG, or RAW formats. All processing happens locally in your browser - no files are uploaded to any server.<br><br>Supported RAW formats include DNG, CR2, NEF, ARW, ORF, RW2, PEF, and SRW.">?</span></h3>
                <div id="drop-zone">
                    <p>Drop images/folders here<br>or click to browse</p>
                    <input type="file" id="file-input" multiple accept=".jpg,.jpeg,.tif,.tiff,.png,.dng,.raw,.cr2,.nef,.arw,.orf,.rw2,.pef,.srw" style="display:none;">
                </div>
                <button id="select-folder" class="secondary-btn">Select Folder (Browser)</button>
                <input type="file" id="folder-input" webkitdirectory directory style="display:none;">
                
                <div id="rtk-options" class="rtk-section">
                    <label class="checkbox-container">
                        <input type="checkbox" id="rtk-enabled" checked>
                        <span class="checkmark"></span>
                        <span class="checkbox-label">Enable RTK Analysis</span>
                        <span class="help-icon" data-help-title="RTK Analysis" data-help-content="Extract RTK (Real-Time Kinematic) GPS data for high-precision positioning analysis. Adds processing overhead but provides centimeter-level accuracy data.">?</span>
                    </label>
                </div>
            </div>

            <div id="stats" style="display:none;">
                <h3>Statistics</h3>
                <div id="stats-content">
                    <p>Images processed: <span id="image-count">0</span></p>
                    <p>Valid GPS: <span id="valid-count">0</span></p>
                    <p>Errors: <span id="error-count">0</span></p>
                </div>
            </div>

            <div id="controls" style="display:none;">
                <button id="add-more-btn" class="secondary-btn">Add More Images</button>
                <button id="done-btn" class="primary-btn">I'm Done</button>
                <button id="download-kml" class="success-btn" style="display:none;">Download KML</button>
                <button id="download-rtk-report" class="secondary-btn" style="display:none;">Download RTK Report</button>
                <button id="open-mymaps" class="accent-btn" style="display:none;">Open in Google My Maps</button>
                <p id="mymaps-hint" class="hint" style="display:none;">We will download the latest KML and open My Maps in a new tab. Choose "Create a new map" â†’ "Import" and select the downloaded file.</p>
                <button id="view-errors" class="warning-btn" style="display:none;">View Error Report</button>
                <hr>
                <button id="new-session-btn" class="secondary-btn">Start New Session</button>
            </div>

            <div id="progress" style="display:none;">
                <h3>Processing...</h3>
                <div id="progress-bar">
                    <div id="progress-fill"></div>
                </div>
                <p id="progress-text">0 / 0</p>
            </div>

            <div id="mapbox-config" class="token-card">
                <h3>Basemap Token (Optional)</h3>
                <p class="hint" style="font-size: 12px;"><span class="help-icon" data-help-title="Mapbox Token" data-help-content="Mapbox tokens provide access to satellite imagery and map tiles. You can get a free token by creating a Mapbox account.<br><br>The token enables hybrid satellite backgrounds for better visualization of your drone imagery locations.<br><br><strong>Token Storage:</strong><br>Your Mapbox token persists in your browser's local storage, so you only need to enter it once. It will remain active until you manually clear it or clear your browser data for this site.">?</span></p>
                <p class="hint" style="font-size: 12px;">The token is not uploaded to the server and is only passed directly to Mapbox from <strong><u>your browser directly</u></strong>.</p>
                <input type="text" id="mapbox-token-input" placeholder="pk.XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX" autocomplete="off" spellcheck="false">
                <button id="mapbox-token-apply" class="primary-btn">Use Mapbox Token</button>
                <button id="mapbox-token-clear" class="secondary-btn">Clear Token</button>
                <p class="hint" style="font-size: 12px;">
                    What is a Mapbox token? 
                    <a href="/mapbox-token-help.html" class="learn-link">Click here to learn how to get one for FREE</a>.
                </p>
                <p id="mapbox-token-status" class="hint" style="font-size: 12px;"></p>
            </div>

            <div id="owner-info" class="token-card">
                <h3><a href="about.html" class="learn-link" style="text-decoration: none; color: inherit;">About This Project</a></h3>
                <p><strong>Maine Sky Pixels LLC</strong></p>
                <p>Questions? Email <a href="mailto:info@maineskypixels.com">info@maineskypixels.com</a></p>
                <p>GitHub: <a href="https://github.com/MaineSkyPixels" target="_blank" rel="noopener">https://github.com/MaineSkyPixels</a></p>
                <p><a href="https://discord.gg/975xxNXgMn" target="_blank" rel="noopener" class="learn-link">ðŸ’¬ Join the Discord server</a></p>
                <p><a href="about.html" class="learn-link">Learn more about this project â†’</a></p>
                <p class="owner-foot">Â© Copyright Maine Sky Pixels 2025</p>
                <p class="owner-foot">Version #101725a</p>
            </div>

        </div>

        <div id="map">
            <div id="map-about-card" class="map-about-card">
                <h3>What it does</h3>
                <ul>
                    <li>Plot geotagged imagery and flight paths instantly in your browser from JPG, TIFF, PNG, and RAW formats.</li>
                    <li>RTK Analysis - Optional high-precision GPS analysis with color-coded markers and detailed statistics.</li>
                    <li>Export clean KML ready for Earth, My Maps, or your GIS tools.</li>
                    <li>RTK Reports - Generate detailed HTML reports with RTK field breakdowns and analysis.</li>
                    <li>Spot GPS gaps quickly so you can troubleshoot metadata issues.</li>
                    <li><a href="about.html" class="learn-link">Learn more about this project</a></li>
                    <li><a href="https://discord.gg/975xxNXgMn" target="_blank" rel="noopener" class="learn-link">ðŸ’¬ Join the Metainfo Mapper Discord server</a></li>
                    <li>This project is still in active development and bugs may occur. build #101725a</li>
                </ul>
            </div>
            <div id="map-intro-card" class="map-intro-card">
                <p><strong>Metainfo Mapper</strong> is an open-source side project built by a Maine-based drone pilot. The app extracts GPS metadata from JPG, TIFF, PNG, and RAW images entirely in your browser, keeps everything on your device, working entirely in-memory with zero logging.</p>
                <div class="pill-row">
                    <span class="pill">100% client-side EXIF parsing</span>
                    <span class="pill">No tracking &middot; No uploads</span>
                    <span class="pill">Built for drone workflows</span>
                </div>
            </div>
        </div>

        <div id="coord-popup" class="popup" style="display:none;">
            <span id="coord-text"></span>
        </div>
    </div>

    <div id="error-modal" class="modal" style="display:none;">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Error Report</h2>
            <div id="error-table-container"></div>
            <button id="download-report">Download Report</button>
        </div>
    </div>

    <div id="privacy-modal" class="modal" style="display:none;">
        <div class="modal-content wide">
            <h2>Your photos never leave this browser</h2>
            <p>Metainfo Mapper runs entirely on your device. After the page loads, it works 100% offline until you close the tab, with no logging, uploads, or analytics. Supports JPG, TIFF, PNG, and RAW image formats.</p>
            <ul>
                <li>No images or metadata are stored on disk.</li>
                <li>Processing is done locally using open-source libraries.</li>
                <li>Refresh or close the tab to clear your session.</li>
                <li>This project is still in active development and bugs may occur.</li>
            </ul>
            <button id="privacy-ack-btn" class="primary-btn">Sounds good</button>
        </div>
    </div>

    <!-- Help Popup -->
    <div id="help-popup-overlay" class="help-popup-overlay"></div>
    <div id="help-popup" class="help-popup">
        <div class="help-popup-header">
            <h3 class="help-popup-title" id="help-popup-title">Help</h3>
            <button class="help-popup-close" id="help-popup-close">&times;</button>
        </div>
        <div class="help-popup-content" id="help-popup-content">
            Help content will be loaded here.
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://unpkg.com/exifr@7.1.3/dist/full.umd.js"></script>
    <!-- exifr library version 2.1.1+ required for TIFF support -->
    <script src="js/app.js"></script>
</body>
</html>